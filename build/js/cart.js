"undefined"!=typeof window&&document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelectorAll(".add-button"),t=document.getElementById("cartSidebar"),a=document.getElementById("cartItems"),n=document.getElementById("cartTotal"),i=document.getElementById("closeCart"),r=document.getElementById("payButton"),o=document.getElementById("mainContent");let c=JSON.parse(localStorage.getItem("cart"))||[];const d={1:{id:1,name:"tartarAtun",image:"/menu/tartar-atun.jpg",precio:150},2:{id:2,name:"ensaladaBrotes",image:"/menu/ensaladaBrotes.jpg",precio:125},3:{id:3,name:"Carpaccio",image:"/menu/carpaccio.jpg",precio:200},4:{id:4,name:"vieiras",image:"/menu/vieiras.jpg",precio:100},5:{id:5,name:"esparragos",image:"/menu/esparragos.jpg",precio:150},6:{id:6,name:"burrata",image:"/menu/burrata.jpg",precio:200},7:{id:7,name:"filete",image:"/menu/res.jpg",precio:250},8:{id:8,name:"rodaballo",image:"/menu/rodaballo.jpg",precio:250},9:{id:9,name:"pato",image:"/menu/pato.jpg",precio:350},10:{id:10,name:"risotto",image:"/menu/risotto.jpg",precio:375},11:{id:11,name:"lubina",image:"/menu/lubina.jpg",precio:150},12:{id:12,name:"cordero",image:"/menu/cordero.jpg",precio:175},13:{id:13,name:"pulpo",image:"/menu/pulpo.jpg",precio:125},14:{id:14,name:"salmon",image:"/menu/salmon.jpg",precio:140},15:{id:15,name:"esfera",image:"/menu/esfera.jpg",precio:150},16:{id:16,name:"Panna cotta",image:"/menu/panna.jpg",precio:200},17:{id:17,name:"Tarta de limón",image:"/menu/pastel-destructurado.jpg",precio:200},18:{id:18,name:"Helado de albahaca",image:"/menu/helado.jpg",precio:250},19:{id:19,name:"textura",image:"/menu/textura-chocolate.jpg",precio:175},20:{id:20,name:"crema",image:"/menu/mascarpone.jpg",precio:100}};function s(){const e=localStorage.getItem("authToken");if(!e)return!1;try{const t=JSON.parse(atob(e.split(".")[1])),a=Math.floor(Date.now()/1e3);return t.exp>a}catch(e){return!1}}function m(e,t){const a=c.findIndex((t=>t.id===e));-1!==a&&(c[a].quantity+=t,c[a].quantity<=0?function(e){c=c.filter((t=>t.id!==e)),localStorage.setItem("cart",JSON.stringify(c)),l()}(e):(localStorage.setItem("cart",JSON.stringify(c)),l()))}function l(){a.innerHTML="";let e=0;c.forEach((t=>{const n=d[t.id],i=document.createElement("div");i.classList.add("cart-item"),i.innerHTML=`\n          <img src="${n.image}" alt="${n.name}" class="cart-item-image" />\n          <span>${n.name}</span>\n          <span>Cantidad: ${t.quantity}</span>\n          <button class="increase-quantity" data-id="${t.id}">+</button>\n        <button class="decrease-quantity" data-id="${t.id}">-</button>\n        `,a.appendChild(i),e+=n.precio*t.quantity})),n.textContent=`Total: $${e}`,document.querySelectorAll(".increase-quantity").forEach((e=>{e.addEventListener("click",(()=>{m(parseInt(e.getAttribute("data-id"),10),1)}))})),document.querySelectorAll(".decrease-quantity").forEach((e=>{e.addEventListener("click",(()=>{m(parseInt(e.getAttribute("data-id"),10),-1)}))}))}e.forEach((e=>{e.addEventListener("click",(()=>{if(!s())return void alert("Por favor, inicia sesión para agregar artículos al carrito.");!function(e){const t=c.findIndex((t=>t.id===e));-1===t?c.push({id:e,quantity:1}):c[t].quantity+=1;localStorage.setItem("cart",JSON.stringify(c)),l()}(parseInt(e.getAttribute("data-id"),10)),t.classList.add("open"),o.classList.add("shifted")}))})),i.addEventListener("click",(()=>{t.classList.remove("open"),o.classList.remove("shifted")})),r.addEventListener("click",(async()=>{if(!s())return void alert("Por favor, inicia sesión para proceder con el pago.");const e=c.reduce(((e,t)=>e+d[t.id].precio*t.quantity),0);try{(await fetch("/api/pedidos",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`},body:JSON.stringify({cart:c,total:e})})).ok?(Swal.fire({title:"Pago Procesado",icon:"success",confirmButtonText:"Aceptar"}),c=[],localStorage.setItem("cart",JSON.stringify(c)),l(),t.classList.remove("open"),o.classList.remove("shifted")):Swal.fire({title:"Error al procesar el pago",icon:"error",confirmButtonText:"Aceptar"})}catch(e){console.error("Error al procesar el pago:",e),Swal.fire({title:"Error al procesar el pago",icon:"error",confirmButtonText:"Aceptar"})}})),l()}));